# Python and SLSA ðŸ’ƒ

<div class="row">
<div class="col-6 col-sm-12">
<p><a href="https://slsa.dev">Supply chain Layers for Software Artifacts</a> (SLSA) is a framework of tools to
generate and verify provenance for software artifacts. In the Python ecosystem
there are two main types of software artifacts: wheels and source distributions.</p>

<p>How can we use the SLSA framework to generate and verify the provenance of
Python artifacts?</p>

<h2>Contents</h2>

<ul>
<li><a href="#building-pure-python-packages">Building pure Python packages</a></li>
<li><a href="#generating-a-provenance-attestation">Generating a provenance attestation</a></li>
<li><a href="#uploading-to-pypi">Uploading to PyPI</a></li>
<li><a href="#verifying-provenance-of-a-python-package">Verifying provenance of a Python package</a></li>
<li><a href="#binary-python-wheels">Binary Python wheels</a></li>
<li><a href="#projects-in-use">Projects in use</a></li>
</ul>

<blockquote>
  <p><strong>NOTE:</strong> This article primarily covers <strong>Python projects which are hosted on GitHub</strong>.
  The SLSA framework works out of the box with GitHub Actions and
  GitHub OpenID Connect with minimal configuration. You can use the SLSA framework without
  using GitHub, but will potentially require more configuration.</p>
</blockquote>

<p><span class="hidden-sm">Below</span><span class="hidden-lg">To the right</span> is what the end-to-end workflow for both maintainers and users looks like going from building the
distributions, creating a provenance attestation, publishing to PyPI, and installing a wheel after verifying its provenance.
Let's walk through each step together!</p>

<p>If you're curious about terminology or processes for Python packaging the <a href="https://packaging.python.org/en/latest/overview/#packaging-python-libraries-and-tools">Python Packaging User Guide</a> is the definitive place to learn more.</p>
</div>
<div class="col-6 col-sm-12">
<center>
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="327px" viewBox="-0.5 -0.5 327 991" style="max-width:100%;max-height:991px;"><defs/><g><rect x="0" y="40" width="320" height="950" fill="#f5f5f5" stroke="#000" pointer-events="all"/><path d="M 0.99 237.84 L 324.16 240.45" fill="none" stroke="#000" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="stroke"/><path d="M 0.99 602.16 L 321.92 599.55" fill="none" stroke="#000" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="stroke"/><path d="M 90 160 L 90 180 L 170 180 L 170 193.63" fill="none" stroke="#000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 170 198.88 L 166.5 191.88 L 170 193.63 L 173.5 191.88 Z" fill="#000" stroke="#000" stroke-miterlimit="10" pointer-events="all"/><rect x="30" y="120" width="120" height="40" fill="rgb(255, 255, 255)" stroke="#000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 140px; margin-left: 31px;"><div style="box-sizing: border-box; font-size: 0px; text-align: center;" data-drawio-colors="color: rgb(0, 0, 0); "><div style="display: inline-block; font-size: 12px; font-family: monospace; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">python -m build</div></div></div></foreignObject><text x="90" y="144" fill="rgb(0, 0, 0)" font-family="monospace" font-size="12px" text-anchor="middle">python -m build</text></switch></g><path d="M 185 80 L 185 100 L 250 100 L 250 113.63" fill="none" stroke="#000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 250 118.88 L 246.5 111.88 L 250 113.63 L 253.5 111.88 Z" fill="#000" stroke="#000" stroke-miterlimit="10" pointer-events="all"/><path d="M 155 80 L 155 100 L 90 100 L 90 113.63" fill="none" stroke="#000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 90 118.88 L 86.5 111.88 L 90 113.63 L 93.5 111.88 Z" fill="#000" stroke="#000" stroke-miterlimit="10" pointer-events="all"/><path d="M 130 0 L 210 0 L 230 40 L 210 80 L 130 80 L 110 40 Z" fill="#dae8fc" stroke="#000" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 40px; margin-left: 111px;"><div style="box-sizing: border-box; font-size: 0px; text-align: center;" data-drawio-colors="color: rgb(0, 0, 0); "><div style="display: inline-block; font-size: 12px; font-family: monospace; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">Source Code</div></div></div></foreignObject><text x="170" y="44" fill="rgb(0, 0, 0)" font-family="monospace" font-size="12px" text-anchor="middle">Source Code</text></switch></g><path d="M 250 160 L 250 180 L 170 180 L 170 233.63" fill="none" stroke="#000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 170 238.88 L 166.5 231.88 L 170 233.63 L 173.5 231.88 Z" fill="#000" stroke="#000" stroke-miterlimit="10" pointer-events="all"/><rect x="190" y="120" width="120" height="40" fill="rgb(255, 255, 255)" stroke="#000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 140px; margin-left: 191px;"><div style="box-sizing: border-box; font-size: 0px; text-align: center;" data-drawio-colors="color: rgb(0, 0, 0); "><div style="display: inline-block; font-size: 12px; font-family: monospace; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">cibuildwheel</div></div></div></foreignObject><text x="250" y="144" fill="rgb(0, 0, 0)" font-family="monospace" font-size="12px" text-anchor="middle">cibuildwheel</text></switch></g><path d="M 170 280 L 170 290 L 90 290 L 90 313.63" fill="none" stroke="#000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 90 318.88 L 86.5 311.88 L 90 313.63 L 93.5 311.88 Z" fill="#000" stroke="#000" stroke-miterlimit="10" pointer-events="all"/><path d="M 170 280 L 170 290 L 250 290 L 250 453.63" fill="none" stroke="#000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 250 458.88 L 246.5 451.88 L 250 453.63 L 253.5 451.88 Z" fill="#000" stroke="#000" stroke-miterlimit="10" pointer-events="all"/><path d="M 130 200 L 210 200 L 230 240 L 210 280 L 130 280 L 110 240 Z" fill="#dae8fc" stroke="#000" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 240px; margin-left: 111px;"><div style="box-sizing: border-box; font-size: 0px; text-align: center;" data-drawio-colors="color: rgb(0, 0, 0); "><div style="display: inline-block; font-size: 12px; font-family: monospace; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">Source Distribution &amp; Wheels</div></div></div></foreignObject><text x="170" y="244" fill="rgb(0, 0, 0)" font-family="monospace" font-size="12px" text-anchor="middle">Source Distribution...</text></switch></g><path d="M 90 360 L 90 373.63" fill="none" stroke="#000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 90 378.88 L 86.5 371.88 L 90 373.63 L 93.5 371.88 Z" fill="#000" stroke="#000" stroke-miterlimit="10" pointer-events="all"/><rect x="30" y="320" width="120" height="40" fill="rgb(255, 255, 255)" stroke="#000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 340px; margin-left: 31px;"><div style="box-sizing: border-box; font-size: 0px; text-align: center;" data-drawio-colors="color: rgb(0, 0, 0); "><div style="display: inline-block; font-size: 12px; font-family: monospace; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">sha256sum *</div></div></div></foreignObject><text x="90" y="344" fill="rgb(0, 0, 0)" font-family="monospace" font-size="12px" text-anchor="middle">sha256sum *</text></switch></g><path d="M 90 420 L 90 433.63" fill="none" stroke="#000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 90 438.88 L 86.5 431.88 L 90 433.63 L 93.5 431.88 Z" fill="#000" stroke="#000" stroke-miterlimit="10" pointer-events="all"/><rect x="30" y="380" width="120" height="40" fill="rgb(255, 255, 255)" stroke="#000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 400px; margin-left: 31px;"><div style="box-sizing: border-box; font-size: 0px; text-align: center;" data-drawio-colors="color: rgb(0, 0, 0); "><div style="display: inline-block; font-size: 12px; font-family: monospace; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">SLSA GitHub Builder</div></div></div></foreignObject><text x="90" y="404" fill="rgb(0, 0, 0)" font-family="monospace" font-size="12px" text-anchor="middle">SLSA GitHub Builder</text></switch></g><path d="M 220 500 L 220 540 L 105 540 L 105 553.63" fill="none" stroke="#000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 105 558.88 L 101.5 551.88 L 105 553.63 L 108.5 551.88 Z" fill="#000" stroke="#000" stroke-miterlimit="10" pointer-events="all"/><path d="M 250 500 L 250 553.63" fill="none" stroke="#000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 250 558.88 L 246.5 551.88 L 250 553.63 L 253.5 551.88 Z" fill="#000" stroke="#000" stroke-miterlimit="10" pointer-events="all"/><rect x="190" y="460" width="120" height="40" fill="rgb(255, 255, 255)" stroke="#000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 480px; margin-left: 191px;"><div style="box-sizing: border-box; font-size: 0px; text-align: center;" data-drawio-colors="color: rgb(0, 0, 0); "><div style="display: inline-block; font-size: 12px; font-family: monospace; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">PyPI Publish GitHub Action</div></div></div></foreignObject><text x="250" y="484" fill="rgb(0, 0, 0)" font-family="monospace" font-size="12px" text-anchor="middle">PyPI Publish GitHub...</text></switch></g><path d="M 90 640 L 90 653.63" fill="none" stroke="#000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 90 658.88 L 86.5 651.88 L 90 653.63 L 93.5 651.88 Z" fill="#000" stroke="#000" stroke-miterlimit="10" pointer-events="all"/><path d="M 50 560 L 130 560 L 150 600 L 130 640 L 50 640 L 30 600 Z" fill="#dae8fc" stroke="#000" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 600px; margin-left: 31px;"><div style="box-sizing: border-box; font-size: 0px; text-align: center;" data-drawio-colors="color: rgb(0, 0, 0); "><div style="display: inline-block; font-size: 12px; font-family: monospace; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">GitHub Release</div></div></div></foreignObject><text x="90" y="604" fill="rgb(0, 0, 0)" font-family="monospace" font-size="12px" text-anchor="middle">GitHub Release</text></switch></g><path d="M 250 640 L 250 653.63" fill="none" stroke="#000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 250 658.88 L 246.5 651.88 L 250 653.63 L 253.5 651.88 Z" fill="#000" stroke="#000" stroke-miterlimit="10" pointer-events="all"/><path d="M 210 560 L 290 560 L 310 600 L 290 640 L 210 640 L 190 600 Z" fill="#dae8fc" stroke="#000" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 600px; margin-left: 191px;"><div style="box-sizing: border-box; font-size: 0px; text-align: center;" data-drawio-colors="color: rgb(0, 0, 0); "><div style="display: inline-block; font-size: 12px; font-family: monospace; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">PyPI Release</div></div></div></foreignObject><text x="250" y="604" fill="rgb(0, 0, 0)" font-family="monospace" font-size="12px" text-anchor="middle">PyPI Release</text></switch></g><path d="M 90 520 L 90 553.63" fill="none" stroke="#000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 90 558.88 L 86.5 551.88 L 90 553.63 L 93.5 551.88 Z" fill="#000" stroke="#000" stroke-miterlimit="10" pointer-events="all"/><path d="M 50 440 L 130 440 L 150 480 L 130 520 L 50 520 L 30 480 Z" fill="#dae8fc" stroke="#000" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 480px; margin-left: 31px;"><div style="box-sizing: border-box; font-size: 0px; text-align: center;" data-drawio-colors="color: rgb(0, 0, 0); "><div style="display: inline-block; font-size: 12px; font-family: monospace; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">Provenance Attestation</div></div></div></foreignObject><text x="90" y="484" fill="rgb(0, 0, 0)" font-family="monospace" font-size="12px" text-anchor="middle">Provenance Attestati...</text></switch></g><path d="M 150 480 L 190 480" fill="none" stroke="#000" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="stroke"/><path d="M 250 800 L 250 820 L 120 820 L 120 833.63" fill="none" stroke="#000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 120 838.88 L 116.5 831.88 L 120 833.63 L 123.5 831.88 Z" fill="#000" stroke="#000" stroke-miterlimit="10" pointer-events="all"/><path d="M 210 720 L 290 720 L 310 760 L 290 800 L 210 800 L 190 760 Z" fill="#dae8fc" stroke="#000" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 760px; margin-left: 191px;"><div style="box-sizing: border-box; font-size: 0px; text-align: center;" data-drawio-colors="color: rgb(0, 0, 0); "><div style="display: inline-block; font-size: 12px; font-family: monospace; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">Wheel</div></div></div></foreignObject><text x="250" y="764" fill="rgb(0, 0, 0)" font-family="monospace" font-size="12px" text-anchor="middle">Wheel</text></switch></g><path d="M 90 800 L 90 833.63" fill="none" stroke="#000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 90 838.88 L 86.5 831.88 L 90 833.63 L 93.5 831.88 Z" fill="#000" stroke="#000" stroke-miterlimit="10" pointer-events="all"/><path d="M 50 720 L 130 720 L 150 760 L 130 800 L 50 800 L 30 760 Z" fill="#dae8fc" stroke="#000" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 760px; margin-left: 31px;"><div style="box-sizing: border-box; font-size: 0px; text-align: center;" data-drawio-colors="color: rgb(0, 0, 0); "><div style="display: inline-block; font-size: 12px; font-family: monospace; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">Provenance Attestation</div></div></div></foreignObject><text x="90" y="764" fill="rgb(0, 0, 0)" font-family="monospace" font-size="12px" text-anchor="middle">Provenance Attestati...</text></switch></g><path d="M 250 700 L 250 713.63" fill="none" stroke="#000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 250 718.88 L 246.5 711.88 L 250 713.63 L 253.5 711.88 Z" fill="#000" stroke="#000" stroke-miterlimit="10" pointer-events="all"/><rect x="190" y="660" width="120" height="40" fill="rgb(255, 255, 255)" stroke="#000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 680px; margin-left: 191px;"><div style="box-sizing: border-box; font-size: 0px; text-align: center;" data-drawio-colors="color: rgb(0, 0, 0); "><div style="display: inline-block; font-size: 12px; font-family: monospace; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">pip download</div></div></div></foreignObject><text x="250" y="684" fill="rgb(0, 0, 0)" font-family="monospace" font-size="12px" text-anchor="middle">pip download</text></switch></g><path d="M 90 700 L 90 713.63" fill="none" stroke="#000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 90 718.88 L 86.5 711.88 L 90 713.63 L 93.5 711.88 Z" fill="#000" stroke="#000" stroke-miterlimit="10" pointer-events="all"/><rect x="30" y="660" width="120" height="40" fill="rgb(255, 255, 255)" stroke="#000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 680px; margin-left: 31px;"><div style="box-sizing: border-box; font-size: 0px; text-align: center;" data-drawio-colors="color: rgb(0, 0, 0); "><div style="display: inline-block; font-size: 12px; font-family: monospace; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">curl</div></div></div></foreignObject><text x="90" y="684" fill="rgb(0, 0, 0)" font-family="monospace" font-size="12px" text-anchor="middle">curl</text></switch></g><path d="M 90 880 L 90 893.63" fill="none" stroke="#000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 90 898.88 L 86.5 891.88 L 90 893.63 L 93.5 891.88 Z" fill="#000" stroke="#000" stroke-miterlimit="10" pointer-events="all"/><rect x="30" y="840" width="120" height="40" fill="rgb(255, 255, 255)" stroke="#000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 860px; margin-left: 31px;"><div style="box-sizing: border-box; font-size: 0px; text-align: center;" data-drawio-colors="color: rgb(0, 0, 0); "><div style="display: inline-block; font-size: 12px; font-family: monospace; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">SLSA Verifier</div></div></div></foreignObject><text x="90" y="864" fill="rgb(0, 0, 0)" font-family="monospace" font-size="12px" text-anchor="middle">SLSA Verifier</text></switch></g><path d="M 130 940 L 183.63 940" fill="none" stroke="#000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 188.88 940 L 181.88 943.5 L 183.63 940 L 181.88 936.5 Z" fill="#000" stroke="#000" stroke-miterlimit="10" pointer-events="all"/><ellipse cx="90" cy="940" rx="40" ry="40" fill="#d5e8d4" stroke="#000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 78px; height: 1px; padding-top: 940px; margin-left: 51px;"><div style="box-sizing: border-box; font-size: 0px; text-align: center;" data-drawio-colors="color: rgb(0, 0, 0); "><div style="display: inline-block; font-size: 12px; font-family: monospace; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">Verified</div></div></div></foreignObject><text x="90" y="944" fill="rgb(0, 0, 0)" font-family="monospace" font-size="12px" text-anchor="middle">Verified</text></switch></g><rect x="190" y="920" width="120" height="40" fill="rgb(255, 255, 255)" stroke="#000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 940px; margin-left: 191px;"><div style="box-sizing: border-box; font-size: 0px; text-align: center;" data-drawio-colors="color: rgb(0, 0, 0); "><div style="display: inline-block; font-size: 12px; font-family: monospace; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">pip install</div></div></div></foreignObject><text x="250" y="944" fill="rgb(0, 0, 0)" font-family="monospace" font-size="12px" text-anchor="middle">pip install</text></switch></g><path d="M 250 920 L 250 800" fill="none" stroke="#000" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="stroke"/><rect x="0" y="600" width="30" height="390" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)rotate(-90 7 795)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe center; width: 380px; height: 1px; padding-top: 795px; margin-left: -183px;"><div style="box-sizing: border-box; font-size: 0px; text-align: center; max-height: 26px; overflow: hidden;" data-drawio-colors="color: rgb(0, 0, 0); "><div style="display: inline-block; font-size: 12px; font-family: monospace; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><font style="font-size: 16px;">Verify &amp; Install</font></div></div></div></foreignObject><text x="7" y="807" fill="rgb(0, 0, 0)" font-family="monospace" font-size="12px" text-anchor="middle">Verify &amp; Install</text></switch></g><rect x="0" y="240" width="30" height="360" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)rotate(-90 7 420)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe center; width: 350px; height: 1px; padding-top: 420px; margin-left: -168px;"><div style="box-sizing: border-box; font-size: 0px; text-align: center; max-height: 26px; overflow: hidden;" data-drawio-colors="color: rgb(0, 0, 0); "><div style="display: inline-block; font-size: 12px; font-family: monospace; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><font style="font-size: 16px;">Publish</font></div></div></div></foreignObject><text x="7" y="432" fill="rgb(0, 0, 0)" font-family="monospace" font-size="12px" text-anchor="middle">Publish</text></switch></g><rect x="0" y="40" width="30" height="200" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)rotate(-90 7 140)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe center; width: 190px; height: 1px; padding-top: 140px; margin-left: -88px;"><div style="box-sizing: border-box; font-size: 0px; text-align: center; max-height: 26px; overflow: hidden;" data-drawio-colors="color: rgb(0, 0, 0); "><div style="display: inline-block; font-size: 12px; font-family: monospace; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><font style="font-size: 16px;">Build</font></div></div></div></foreignObject><text x="7" y="152" fill="rgb(0, 0, 0)" font-family="monospace" font-size="12px" text-anchor="middle">Build</text></switch></g></g><switch><g requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"/><a transform="translate(0,-5)" xlink:href="https://www.diagrams.net/doc/faq/svg-export-text-problems" target="_blank"><text text-anchor="middle" font-size="10px" x="50%" y="100%">Text is not SVG - cannot display</text></a></switch></svg>
<p><small>End-to-end flow from building dists, generating and verifying provenance, and installing with pip.</small></p>
</center>
</div>
</div>

## Building pure Python packages

Pure Python packages typically only have two artifacts, a source distribution and a pure Python wheel.
Pure Python packages can be built from source using a package called [`build`](https://pypi.org/project/build).

Below is the GitHub Actions job definition that builds a pure Python wheel and source distribution
and creates SHA-256 hashes of each artifact:

```yaml
jobs:
  build:
    steps:
      - uses: actions/checkout@...
      - uses: actions/setup-python@...
        with:
          python-version: 3.x
      - run: |
          # Install 'build' and create sdist & wheel
          python -m pip install build
          python -m build

          # Gather hashes of all files
          cd dist && echo "hashes=$(sha256sum * | base64 -w0)" >> $GITHUB_OUTPUT
      - uses: actions/upload-artifacts@...
        with:
          path: ./dist
```

The built distributions get uploaded to GitHub Artifacts storage to be used later in the "upload to PyPI" job.
We also store the hashes of each distribution in the `hashes` output so it can be used
as an input to the `provenance` job.

> **NOTE:** SLSA uses the output of `sha265sum` as the input to the "subject" field
> in the provenance attestation. The output of `sha256sum` is one or more (name, hash) pairs
> so the `cd dist/ && sha256sum *` is done to avoid having `dist/...` in the subject
> name of each artifact. This is purely for aesthetic reasons, as the hash is the
> actual identifier for the artifact.

## Generating a provenance attestation

Now that we've built our sdist and wheel we can generate a provenance attestation from the file hashes.
Since we're taking the output of another GitHub Action job as an input we configure the [`needs` option](https://docs.github.com/en/actions/using-workflows/workflow-syntax-for-github-actions#jobsjob_idneeds)
for the `provenance` job. See the hashes being used below in `subject-base64`:

```yaml
jobs:
  provenance:
    needs: [build]
    uses: slsa-framework/slsa-github-builder/.github/workflows/generator_generic_slsa3.yml@v1.5.0
    permissions:
      # Needed to detect the GitHub Actions environment
      actions: read
      # Needed to create the provenance via GitHub OIDC
      id-token: write
      # Needed to create and upload to GitHub Releases
      contents: write
    with:
      # SHA-256 hashes of the Python distributions.
      subject-base64: ${{ provenance.needs.build.output.hashes }}
      # Uploads the provenance file to a draft GitHub Release.
      upload-assets: true
```

You'll notice that this doesn't define any individual steps like is typical for a GitHub Workflow.
Instead, SLSA builders use [reusable workflows](https://docs.github.com/en/actions/using-workflows/reusing-workflows)
feature in order to prove that a given builder behavior can't be modified by the user or another process.

Provenance attestations files are [in-toto](https://in-toto.io) [JSON lines](https://jsonlines.org) files that end in `.intoto.jsonl`.
`*.intoto.jsonl` files can contain attestations for multiple artifacts (as will almost always be the case for Python due to sdist/wheels)
but can also contain multiple provenance attestations within the same file. The `.jsonl` format means
that this file is a "JSON lines" file, meaning one JSON document per line.

> **NOTE:** Confusingly the GitHub job permission "`id-token`" requires the "`write`"
> permission to read the GitHub OIDC token. A value of "`read`" doesn't allow you to read the value... ðŸ¤·.
> See the [GitHub documentation](https://docs.github.com/en/actions/deployment/security-hardening-your-deployments/about-security-hardening-with-openid-connect#adding-permissions-settings) for more info on the "`id-token`" job permission.

## Uploading to PyPI

<div class="row">
<div class="col-6">
<center>
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="321px" viewBox="-0.5 -0.5 321 441" style="max-width:100%;max-height:441px;"><defs/><g><rect x="0" y="40" width="320" height="360" fill="#f5f5f5" stroke="#000" pointer-events="all"/><path d="M 170 80 L 170 90 L 90 90 L 90 113.63" fill="none" stroke="#000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 90 118.88 L 86.5 111.88 L 90 113.63 L 93.5 111.88 Z" fill="#000" stroke="#000" stroke-miterlimit="10" pointer-events="all"/><path d="M 170 80 L 170 90 L 250 90 L 250 233.63" fill="none" stroke="#000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 250 238.88 L 246.5 231.88 L 250 233.63 L 253.5 231.88 Z" fill="#000" stroke="#000" stroke-miterlimit="10" pointer-events="all"/><path d="M 130 0 L 210 0 L 230 40 L 210 80 L 130 80 L 110 40 Z" fill="#dae8fc" stroke="#000" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 40px; margin-left: 111px;"><div style="box-sizing: border-box; font-size: 0px; text-align: center;" data-drawio-colors="color: rgb(0, 0, 0); "><div style="display: inline-block; font-size: 12px; font-family: monospace; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">Source Distribution &amp; Wheels</div></div></div></foreignObject><text x="170" y="44" fill="rgb(0, 0, 0)" font-family="monospace" font-size="12px" text-anchor="middle">Source Distribution...</text></switch></g><path d="M 90 160 L 90 173.63" fill="none" stroke="#000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 90 178.88 L 86.5 171.88 L 90 173.63 L 93.5 171.88 Z" fill="#000" stroke="#000" stroke-miterlimit="10" pointer-events="all"/><rect x="30" y="120" width="120" height="40" fill="rgb(255, 255, 255)" stroke="#000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 140px; margin-left: 31px;"><div style="box-sizing: border-box; font-size: 0px; text-align: center;" data-drawio-colors="color: rgb(0, 0, 0); "><div style="display: inline-block; font-size: 12px; font-family: monospace; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">sha256sum *</div></div></div></foreignObject><text x="90" y="144" fill="rgb(0, 0, 0)" font-family="monospace" font-size="12px" text-anchor="middle">sha256sum *</text></switch></g><path d="M 90 220 L 90 233.63" fill="none" stroke="#000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 90 238.88 L 86.5 231.88 L 90 233.63 L 93.5 231.88 Z" fill="#000" stroke="#000" stroke-miterlimit="10" pointer-events="all"/><rect x="30" y="180" width="120" height="40" fill="rgb(255, 255, 255)" stroke="#000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 200px; margin-left: 31px;"><div style="box-sizing: border-box; font-size: 0px; text-align: center;" data-drawio-colors="color: rgb(0, 0, 0); "><div style="display: inline-block; font-size: 12px; font-family: monospace; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">SLSA GitHub Builder</div></div></div></foreignObject><text x="90" y="204" fill="rgb(0, 0, 0)" font-family="monospace" font-size="12px" text-anchor="middle">SLSA GitHub Builder</text></switch></g><path d="M 220 320 L 220 340 L 105 340 L 105 353.63" fill="none" stroke="#000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 105 358.88 L 101.5 351.88 L 105 353.63 L 108.5 351.88 Z" fill="#000" stroke="#000" stroke-miterlimit="10" pointer-events="all"/><path d="M 250 320 L 250 353.63" fill="none" stroke="#000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 250 358.88 L 246.5 351.88 L 250 353.63 L 253.5 351.88 Z" fill="#000" stroke="#000" stroke-miterlimit="10" pointer-events="all"/><rect x="190" y="240" width="120" height="80" fill="rgb(255, 255, 255)" stroke="#000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 280px; margin-left: 191px;"><div style="box-sizing: border-box; font-size: 0px; text-align: center;" data-drawio-colors="color: rgb(0, 0, 0); "><div style="display: inline-block; font-size: 12px; font-family: monospace; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">PyPI Publish GitHub Action</div></div></div></foreignObject><text x="250" y="284" fill="rgb(0, 0, 0)" font-family="monospace" font-size="12px" text-anchor="middle">PyPI Publish GitHub...</text></switch></g><path d="M 50 360 L 130 360 L 150 400 L 130 440 L 50 440 L 30 400 Z" fill="#dae8fc" stroke="#000" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 400px; margin-left: 31px;"><div style="box-sizing: border-box; font-size: 0px; text-align: center;" data-drawio-colors="color: rgb(0, 0, 0); "><div style="display: inline-block; font-size: 12px; font-family: monospace; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">GitHub Release</div></div></div></foreignObject><text x="90" y="404" fill="rgb(0, 0, 0)" font-family="monospace" font-size="12px" text-anchor="middle">GitHub Release</text></switch></g><path d="M 210 360 L 290 360 L 310 400 L 290 440 L 210 440 L 190 400 Z" fill="#dae8fc" stroke="#000" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 400px; margin-left: 191px;"><div style="box-sizing: border-box; font-size: 0px; text-align: center;" data-drawio-colors="color: rgb(0, 0, 0); "><div style="display: inline-block; font-size: 12px; font-family: monospace; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">PyPI Release</div></div></div></foreignObject><text x="250" y="404" fill="rgb(0, 0, 0)" font-family="monospace" font-size="12px" text-anchor="middle">PyPI Release</text></switch></g><path d="M 90 320 L 90 353.63" fill="none" stroke="#000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 90 358.88 L 86.5 351.88 L 90 353.63 L 93.5 351.88 Z" fill="#000" stroke="#000" stroke-miterlimit="10" pointer-events="all"/><path d="M 50 240 L 130 240 L 150 280 L 130 320 L 50 320 L 30 280 Z" fill="#dae8fc" stroke="#000" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 280px; margin-left: 31px;"><div style="box-sizing: border-box; font-size: 0px; text-align: center;" data-drawio-colors="color: rgb(0, 0, 0); "><div style="display: inline-block; font-size: 12px; font-family: monospace; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">Provenance Attestation</div></div></div></foreignObject><text x="90" y="284" fill="rgb(0, 0, 0)" font-family="monospace" font-size="12px" text-anchor="middle">Provenance Attestati...</text></switch></g><path d="M 150 280 L 190 280" fill="none" stroke="#000" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="stroke"/><rect x="0" y="40" width="30" height="360" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)rotate(-90 7 220)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe center; width: 350px; height: 1px; padding-top: 220px; margin-left: -168px;"><div style="box-sizing: border-box; font-size: 0px; text-align: center; max-height: 26px; overflow: hidden;" data-drawio-colors="color: rgb(0, 0, 0); "><div style="display: inline-block; font-size: 12px; font-family: monospace; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><font style="font-size: 16px;">Publish</font></div></div></div></foreignObject><text x="7" y="232" fill="rgb(0, 0, 0)" font-family="monospace" font-size="12px" text-anchor="middle">Publish</text></switch></g></g><switch><g requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"/><a transform="translate(0,-5)" xlink:href="https://www.diagrams.net/doc/faq/svg-export-text-problems" target="_blank"><text text-anchor="middle" font-size="10px" x="50%" y="100%">Text is not SVG - cannot display</text></a></switch></svg>
</center>
</div>
<div class="col-6">
<p>We're using the official <a href="https://github.com/pypa/gh-action-pypi-publish"><code>pypa/gh-action-pypi-publish</code> GitHub Action</a> to upload our wheels to PyPI.</p>

<p>Notice that the <code>publish</code> job requires both the <code>build</code> and <code>provenance</code> jobs to be complete before starting.
This means that we can assume that the provenance job has already created a GitHub Release draft for us (thanks to the <code>upload-assets: true</code> setting)
and we can assume that the job succeeded. We wouldn't want to upload these distributions to PyPI without creating a provenance file first
so we upload to PyPI last.</p>
</div>
</div>

```yaml
publish:
  needs: ["build", "provenance"]
  permissions:
    contents: write
  runs-on: "ubuntu-latest"
  steps:
  # Download the built distributions
  - uses: "actions/download-artifact@..."
    with:
      name: "dist"
      path: "dist/"
  # Upload distributions to the GitHub Release
  - env:
      GITHUB_TOKEN: "${{ secrets.GITHUB_TOKEN }}"
    run: |
      gh release upload ${{ github.ref_name }} \
        dist/* --repo ${{ github.repository }}
  # Publish distributions to PyPI
  - uses: "pypa/gh-action-pypi-publish@..."
    with:
      user: __token__
      password: ${{ secrets.PYPI_TOKEN }}
```

Notice that the `publish` job requires both the `build` and `provenance` jobs to be complete before starting.
This means that we can assume that the provenance job has already created a GitHub Release draft for us (thanks to the `upload-assets: true` setting)
and we can assume that the job succeeded. We wouldn't want to upload these distributions to PyPI without creating a provenance file first
so we upload to PyPI last.

## Verifying provenance of a Python package

<div class="row">
<div class="col-6">
<center>
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="321px" viewBox="-0.5 -0.5 321 431" style="max-width:100%;max-height:431px;"><defs/><g><rect x="0" y="40" width="320" height="390" fill="#f5f5f5" stroke="#000" pointer-events="all"/><path d="M 90 80 L 90 93.63" fill="none" stroke="#000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 90 98.88 L 86.5 91.88 L 90 93.63 L 93.5 91.88 Z" fill="#000" stroke="#000" stroke-miterlimit="10" pointer-events="all"/><path d="M 50 0 L 130 0 L 150 40 L 130 80 L 50 80 L 30 40 Z" fill="#dae8fc" stroke="#000" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 40px; margin-left: 31px;"><div style="box-sizing: border-box; font-size: 0px; text-align: center;" data-drawio-colors="color: rgb(0, 0, 0); "><div style="display: inline-block; font-size: 12px; font-family: monospace; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">GitHub Release</div></div></div></foreignObject><text x="90" y="44" fill="rgb(0, 0, 0)" font-family="monospace" font-size="12px" text-anchor="middle">GitHub Release</text></switch></g><path d="M 250 80 L 250 93.63" fill="none" stroke="#000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 250 98.88 L 246.5 91.88 L 250 93.63 L 253.5 91.88 Z" fill="#000" stroke="#000" stroke-miterlimit="10" pointer-events="all"/><path d="M 210 0 L 290 0 L 310 40 L 290 80 L 210 80 L 190 40 Z" fill="#dae8fc" stroke="#000" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 40px; margin-left: 191px;"><div style="box-sizing: border-box; font-size: 0px; text-align: center;" data-drawio-colors="color: rgb(0, 0, 0); "><div style="display: inline-block; font-size: 12px; font-family: monospace; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">PyPI Release</div></div></div></foreignObject><text x="250" y="44" fill="rgb(0, 0, 0)" font-family="monospace" font-size="12px" text-anchor="middle">PyPI Release</text></switch></g><path d="M 250 240 L 250 260 L 120 260 L 120 273.63" fill="none" stroke="#000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 120 278.88 L 116.5 271.88 L 120 273.63 L 123.5 271.88 Z" fill="#000" stroke="#000" stroke-miterlimit="10" pointer-events="all"/><path d="M 210 160 L 290 160 L 310 200 L 290 240 L 210 240 L 190 200 Z" fill="#dae8fc" stroke="#000" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 200px; margin-left: 191px;"><div style="box-sizing: border-box; font-size: 0px; text-align: center;" data-drawio-colors="color: rgb(0, 0, 0); "><div style="display: inline-block; font-size: 12px; font-family: monospace; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">Wheel</div></div></div></foreignObject><text x="250" y="204" fill="rgb(0, 0, 0)" font-family="monospace" font-size="12px" text-anchor="middle">Wheel</text></switch></g><path d="M 90 240 L 90 273.63" fill="none" stroke="#000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 90 278.88 L 86.5 271.88 L 90 273.63 L 93.5 271.88 Z" fill="#000" stroke="#000" stroke-miterlimit="10" pointer-events="all"/><path d="M 50 160 L 130 160 L 150 200 L 130 240 L 50 240 L 30 200 Z" fill="#dae8fc" stroke="#000" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 200px; margin-left: 31px;"><div style="box-sizing: border-box; font-size: 0px; text-align: center;" data-drawio-colors="color: rgb(0, 0, 0); "><div style="display: inline-block; font-size: 12px; font-family: monospace; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">Provenance Attestation</div></div></div></foreignObject><text x="90" y="204" fill="rgb(0, 0, 0)" font-family="monospace" font-size="12px" text-anchor="middle">Provenance Attestati...</text></switch></g><path d="M 250 140 L 250 153.63" fill="none" stroke="#000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 250 158.88 L 246.5 151.88 L 250 153.63 L 253.5 151.88 Z" fill="#000" stroke="#000" stroke-miterlimit="10" pointer-events="all"/><rect x="190" y="100" width="120" height="40" fill="rgb(255, 255, 255)" stroke="#000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 120px; margin-left: 191px;"><div style="box-sizing: border-box; font-size: 0px; text-align: center;" data-drawio-colors="color: rgb(0, 0, 0); "><div style="display: inline-block; font-size: 12px; font-family: monospace; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">pip download</div></div></div></foreignObject><text x="250" y="124" fill="rgb(0, 0, 0)" font-family="monospace" font-size="12px" text-anchor="middle">pip download</text></switch></g><path d="M 90 140 L 90 153.63" fill="none" stroke="#000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 90 158.88 L 86.5 151.88 L 90 153.63 L 93.5 151.88 Z" fill="#000" stroke="#000" stroke-miterlimit="10" pointer-events="all"/><rect x="30" y="100" width="120" height="40" fill="rgb(255, 255, 255)" stroke="#000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 120px; margin-left: 31px;"><div style="box-sizing: border-box; font-size: 0px; text-align: center;" data-drawio-colors="color: rgb(0, 0, 0); "><div style="display: inline-block; font-size: 12px; font-family: monospace; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">curl</div></div></div></foreignObject><text x="90" y="124" fill="rgb(0, 0, 0)" font-family="monospace" font-size="12px" text-anchor="middle">curl</text></switch></g><path d="M 90 320 L 90 333.63" fill="none" stroke="#000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 90 338.88 L 86.5 331.88 L 90 333.63 L 93.5 331.88 Z" fill="#000" stroke="#000" stroke-miterlimit="10" pointer-events="all"/><rect x="30" y="280" width="120" height="40" fill="rgb(255, 255, 255)" stroke="#000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 300px; margin-left: 31px;"><div style="box-sizing: border-box; font-size: 0px; text-align: center;" data-drawio-colors="color: rgb(0, 0, 0); "><div style="display: inline-block; font-size: 12px; font-family: monospace; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">SLSA Verifier</div></div></div></foreignObject><text x="90" y="304" fill="rgb(0, 0, 0)" font-family="monospace" font-size="12px" text-anchor="middle">SLSA Verifier</text></switch></g><path d="M 130 380 L 183.63 380" fill="none" stroke="#000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 188.88 380 L 181.88 383.5 L 183.63 380 L 181.88 376.5 Z" fill="#000" stroke="#000" stroke-miterlimit="10" pointer-events="all"/><ellipse cx="90" cy="380" rx="40" ry="40" fill="#d5e8d4" stroke="#000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 78px; height: 1px; padding-top: 380px; margin-left: 51px;"><div style="box-sizing: border-box; font-size: 0px; text-align: center;" data-drawio-colors="color: rgb(0, 0, 0); "><div style="display: inline-block; font-size: 12px; font-family: monospace; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">Verified</div></div></div></foreignObject><text x="90" y="384" fill="rgb(0, 0, 0)" font-family="monospace" font-size="12px" text-anchor="middle">Verified</text></switch></g><rect x="190" y="360" width="120" height="40" fill="rgb(255, 255, 255)" stroke="#000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 380px; margin-left: 191px;"><div style="box-sizing: border-box; font-size: 0px; text-align: center;" data-drawio-colors="color: rgb(0, 0, 0); "><div style="display: inline-block; font-size: 12px; font-family: monospace; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">pip install</div></div></div></foreignObject><text x="250" y="384" fill="rgb(0, 0, 0)" font-family="monospace" font-size="12px" text-anchor="middle">pip install</text></switch></g><path d="M 250 360 L 250 240" fill="none" stroke="#000" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="stroke"/><rect x="0" y="40" width="30" height="390" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)rotate(-90 7 235)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe center; width: 380px; height: 1px; padding-top: 235px; margin-left: -183px;"><div style="box-sizing: border-box; font-size: 0px; text-align: center; max-height: 26px; overflow: hidden;" data-drawio-colors="color: rgb(0, 0, 0); "><div style="display: inline-block; font-size: 12px; font-family: monospace; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><font style="font-size: 16px;">Verify &amp; Install</font></div></div></div></foreignObject><text x="7" y="247" fill="rgb(0, 0, 0)" font-family="monospace" font-size="12px" text-anchor="middle">Verify &amp; Install</text></switch></g></g><switch><g requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"/><a transform="translate(0,-5)" xlink:href="https://www.diagrams.net/doc/faq/svg-export-text-problems" target="_blank"><text text-anchor="middle" font-size="10px" x="50%" y="100%">Text is not SVG - cannot display</text></a></switch></svg>
<small></small>
</center>
</div>
<div class="col-6">

<p>Let's take a real Python package and verify its provenance. urllib3 has published
a provenance attestation to GitHub Releases for the past few releases. Let's
use <a href="https://github.com/urllib3/urllib3/releases/tag/1.26.14">v1.26.14</a> for this example. To start we need
to download the <a href="https://github.com/slsa-framework/slsa-verifier/releases"><code>slsa-verifier</code> tool for our architecture</a> (Using `linux-amd64` in the below examples).</p>

<p>After we download the <code>slsa-verifier</code> tool let's fetch the urllib3 wheel from PyPI
without installing it using <a href="https://pip.pypa.io/en/stable/cli/pip_download/"><code>pip download</code></a>. We use the <a href="https://pip.pypa.io/en/stable/cli/pip_install/#cmdoption-only-binary"><code>--only-binary</code></a> option to
force pip to download a wheel rather than a source distribution.</p>
</div>
</div>

```shell
$ python -m pip download \
  --only-binary=:all: urllib3

Collecting urllib3
  ...
Saved ./urllib3-1.26.14-py2.py3-none-any.whl
Successfully downloaded urllib3
```

After we've downloaded the package we need to download the provenance attestation from the GitHub Release.
We need to use the same GitHub Release as the package version to receive the correct attestation:

```shell
$ curl --location -O \
  https://github.com/urllib3/urllib3/releases/download/1.26.14/multiple.intoto.jsonl
```

> **NOTE:** The `-O` option for curl saves the response data into a file based on the requested path, in
> this case the data will be saved to `multiple.intoto.jsonl`. The `--location` flag means
> that curl will follow any redirects.

The name `multiple.intoto.jsonl` is the standard name for a provenance attestation that contains attestations for multiple
artifacts. This will almost always be the case for Python projects since there is almost always a source distribution and 
at least one wheel.

At this point we should have two files in our current working directory, the wheel and the provenance attestation.
Let's take a quick peek just to make sure:

```shell
$ ls

multiple.intoto.jsonl
urllib3-1.26.14-py2.py3-none-any.whl
```

Looking good so far!

From here we can verify the provenance using `slsa-verifier`. We
can verify the most important thing, **which GitHub repository actually built the wheel**,
along with other bits of information like the git tag, branch, and builder ID:

- Source repository (`--source-uri`)
- Builder ID (`--builder-id`)
- Git branch (`--source-branch`)
- Git tag (`--source-tag`)

So if we wanted to verify the source repository of the wheel we use `--source-uri`:

```shell
# Verifying just the GitHub repository
$ slsa-verifier-linux-amd64 verify-artifact \
    --provenance-path multiple.intoto.jsonl \
    --source-uri github.com/urllib3/urllib3 \
    urllib3-1.26.14-py2.py3-none-any.whl

Verified signature against tlog entry index 10945443 at URL: https://rekor.sigstore.dev/api/v1/log/entries/24296fb24b8ad77aa7bf06593bb44761ad6ef9f7f0f9ac8fe028a52cc6f926039cdef1652a064bc1
Verified build using builder https://github.com/slsa-framework/slsa-github-generator/.github/workflows/generator_generic_slsa3.yml@refs/tags/v1.2.1 at commit f96a1cfc568beddf1e17ce7609609eca40780be5
PASSED: Verified SLSA provenance
```

**Success!** ðŸ¥³ We've verified this wheel's provenance so now we can install it knowing that it was built as we expect:

```shell
$ python -m pip install ./urllib3-1.26.14-py2.py3-none-any.whl

Processing ./urllib3-1.26.14-py2.py3-none-any.whl
Installing collected packages: urllib3
Successfully installed urllib3-1.26.14
```

## Binary Python wheels

<div class="row">
<div class="col-6 col-12-sm">
<p>Python wheels are not all pure Python! One of Python's greatest strengths, being the glue language for C, C++, Fortran, Rust, Go (and more),
complicates Python's packaging and provenance story compared to some other programming languages.</p>

<p>Binary wheels need to be built for multiple platforms, architectures, and if the project isn't able to
use the <a href="https://docs.python.org/3/c-api/stable.html#stable-application-binary-interface">Stable ABI</a>
then new wheels need to be compiled for every new Python version. To get a sense of how many wheels
are needed by projects in this situation you can take a look at MarkupSafe which <a href="https://pypi.org/project/MarkupSafe/#files">for v2.1.2 shipped nearly 50 wheels</a>.
When a new Python version is released there will be at least 10 more to cover all the platforms for Python 3.12 as well.</p>
</div>
<div class="col-6 col-12-sm">
<center>
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="261px" viewBox="-0.5 -0.5 261 401" style="max-width:100%;max-height:401px;"><defs/><g><rect x="0" y="40" width="260" height="320" fill="#f5f5f5" stroke="#000" pointer-events="all"/><g transform="translate(-0.5 -0.5)rotate(-90 7 200)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe center; width: 318px; height: 1px; padding-top: 200px; margin-left: -152px;"><div style="box-sizing: border-box; font-size: 0px; text-align: center;" data-drawio-colors="color: #333; "><div style="display: inline-block; font-size: 12px; font-family: monospace; color: rgb(51, 51, 51); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><font style="font-size: 19px;"><font style="font-size: 19px;"><font style="font-size: 19px;"><font style="font-size: 19px;"><font style="font-size: 19px;"><font style="font-size: 19px;"><font style="font-size: 19px;"><font style="font-size: 19px;"><font style="font-size: 18px;"><font style="font-size: 17px;"><font style="font-size: 16px;">Build</font></font></font></font></font></font></font></font></font></font></font></div></div></div></foreignObject><text x="7" y="212" fill="#333" font-family="monospace" font-size="12px" text-anchor="middle">Build</text></switch></g><path d="M 130 140 L 130 153.63" fill="none" stroke="#000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 130 158.88 L 126.5 151.88 L 130 153.63 L 133.5 151.88 Z" fill="#000" stroke="#000" stroke-miterlimit="10" pointer-events="all"/><path d="M 190 120 L 240 120 L 240 300 L 130 300 L 130 313.63" fill="none" stroke="#000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 130 318.88 L 126.5 311.88 L 130 313.63 L 133.5 311.88 Z" fill="#000" stroke="#000" stroke-miterlimit="10" pointer-events="all"/><rect x="70" y="100" width="120" height="40" fill="rgb(255, 255, 255)" stroke="#000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 120px; margin-left: 71px;"><div style="box-sizing: border-box; font-size: 0px; text-align: center;" data-drawio-colors="color: rgb(0, 0, 0); "><div style="display: inline-block; font-size: 12px; font-family: monospace; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">python -m build --sdist</div></div></div></foreignObject><text x="130" y="124" fill="rgb(0, 0, 0)" font-family="monospace" font-size="12px" text-anchor="middle">python -m build --sd...</text></switch></g><path d="M 130 200 L 130 213.63" fill="none" stroke="#000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 130 218.88 L 126.5 211.88 L 130 213.63 L 133.5 211.88 Z" fill="#000" stroke="#000" stroke-miterlimit="10" pointer-events="all"/><rect x="70" y="160" width="120" height="40" fill="rgb(255, 255, 255)" stroke="#000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 180px; margin-left: 71px;"><div style="box-sizing: border-box; font-size: 0px; text-align: center;" data-drawio-colors="color: rgb(0, 0, 0); "><div style="display: inline-block; font-size: 12px; font-family: monospace; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">cibuildwheel</div></div></div></foreignObject><text x="130" y="184" fill="rgb(0, 0, 0)" font-family="monospace" font-size="12px" text-anchor="middle">cibuildwheel</text></switch></g><path d="M 130 80 L 130 93.63" fill="none" stroke="#000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 130 98.88 L 126.5 91.88 L 130 93.63 L 133.5 91.88 Z" fill="#000" stroke="#000" stroke-miterlimit="10" pointer-events="all"/><path d="M 90 0 L 170 0 L 190 40 L 170 80 L 90 80 L 70 40 Z" fill="#dae8fc" stroke="#000" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 40px; margin-left: 71px;"><div style="box-sizing: border-box; font-size: 0px; text-align: center;" data-drawio-colors="color: rgb(0, 0, 0); "><div style="display: inline-block; font-size: 16px; font-family: monospace; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><font style="font-size: 12px;">Source Code<br /></font></div></div></div></foreignObject><text x="130" y="45" fill="rgb(0, 0, 0)" font-family="monospace" font-size="16px" text-anchor="middle">Source Code&#xa;</text></switch></g><path d="M 90 320 L 170 320 L 190 360 L 170 400 L 90 400 L 70 360 Z" fill="#dae8fc" stroke="#000" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 360px; margin-left: 71px;"><div style="box-sizing: border-box; font-size: 0px; text-align: center;" data-drawio-colors="color: rgb(0, 0, 0); "><div style="display: inline-block; font-size: 16px; font-family: monospace; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><font style="font-size: 12px;">Source Distribution &amp; Wheels<br /></font></div></div></div></foreignObject><text x="130" y="365" fill="rgb(0, 0, 0)" font-family="monospace" font-size="16px" text-anchor="middle">Source Distribu...</text></switch></g><rect x="40" y="220" width="180" height="20" fill="rgb(255, 255, 255)" stroke="#000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 178px; height: 1px; padding-top: 230px; margin-left: 41px;"><div style="box-sizing: border-box; font-size: 0px; text-align: center;" data-drawio-colors="color: rgb(0, 0, 0); "><div style="display: inline-block; font-size: 12px; font-family: monospace; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">GitHub Actions</div></div></div></foreignObject><text x="130" y="234" fill="rgb(0, 0, 0)" font-family="monospace" font-size="12px" text-anchor="middle">GitHub Actions</text></switch></g><path d="M 70 280 L 70 300 L 130 300 L 130 313.63" fill="none" stroke="#000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 130 318.88 L 126.5 311.88 L 130 313.63 L 133.5 311.88 Z" fill="#000" stroke="#000" stroke-miterlimit="10" pointer-events="all"/><rect x="40" y="240" width="60" height="40" fill="rgb(255, 255, 255)" stroke="#000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 58px; height: 1px; padding-top: 260px; margin-left: 41px;"><div style="box-sizing: border-box; font-size: 0px; text-align: center;" data-drawio-colors="color: rgb(0, 0, 0); "><div style="display: inline-block; font-size: 12px; font-family: monospace; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">Linux</div></div></div></foreignObject><text x="70" y="264" fill="rgb(0, 0, 0)" font-family="monospace" font-size="12px" text-anchor="middle">Linux</text></switch></g><path d="M 190 280 L 190 300 L 130 300 L 130 313.63" fill="none" stroke="#000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 130 318.88 L 126.5 311.88 L 130 313.63 L 133.5 311.88 Z" fill="#000" stroke="#000" stroke-miterlimit="10" pointer-events="all"/><rect x="160" y="240" width="60" height="40" fill="rgb(255, 255, 255)" stroke="#000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 58px; height: 1px; padding-top: 260px; margin-left: 161px;"><div style="box-sizing: border-box; font-size: 0px; text-align: center;" data-drawio-colors="color: rgb(0, 0, 0); "><div style="display: inline-block; font-size: 12px; font-family: monospace; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">macOS</div></div></div></foreignObject><text x="190" y="264" fill="rgb(0, 0, 0)" font-family="monospace" font-size="12px" text-anchor="middle">macOS</text></switch></g><rect x="100" y="240" width="60" height="40" fill="rgb(255, 255, 255)" stroke="#000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 58px; height: 1px; padding-top: 260px; margin-left: 101px;"><div style="box-sizing: border-box; font-size: 0px; text-align: center;" data-drawio-colors="color: rgb(0, 0, 0); "><div style="display: inline-block; font-size: 12px; font-family: monospace; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">Windows</div></div></div></foreignObject><text x="130" y="264" fill="rgb(0, 0, 0)" font-family="monospace" font-size="12px" text-anchor="middle">Windows</text></switch></g><path d="M 130 280 L 130 313.63" fill="none" stroke="#000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 130 318.88 L 126.5 311.88 L 130 313.63 L 133.5 311.88 Z" fill="#000" stroke="#000" stroke-miterlimit="10" pointer-events="all"/></g><switch><g requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"/><a transform="translate(0,-5)" xlink:href="https://www.diagrams.net/doc/faq/svg-export-text-problems" target="_blank"><text text-anchor="middle" font-size="10px" x="50%" y="100%">Text is not SVG - cannot display</text></a></switch></svg>
</center>
</div>
</div>

Unfortunately this means we'll need to create new artifacts some time after the initial release, which doesn't have a straightforward story in SLSA.
There are two solutions to this problem:

- Create a new release for the package instead of only new wheels.
- Build the new wheels and create a new provenance attestation.

### Creating a new release

The simplest way is to create a new release for the package
after updating the `cibuildwheel` action to the latest to support all the new wheel targets.
This will create a new provenance attestation, sdist, and wheels. However, this feels
like an unfortunate outcome if nothing about the source code of the project has changed.

Compared to new wheels, new releases cause much more churn:

* Additional work for maintainers
* Storage and compute resources (each release of PyTorch is [~6GB of wheels](https://pypi.org/project/torch/#files))
* Dependents need to update lock files (Dependabot fatigue, anyone?)
* Downstream repackaging and distribution

### Provenance for post-release wheels

So what can be done if we don't want to create a new release just for provenance of new wheels?

Markupsafe's solution for this is adding a [manual `workflow_dispatch` trigger](https://docs.github.com/en/actions/managing-workflow-runs/manually-running-a-workflow)
to run the typical wheel-building workflows but configured to only build new wheels for a given Python version (ie `cp312` for CPython 3.12).
These wheels then get attested to with SLSA and uploaded to PyPI like normal, but the new provenance attestation file gets added to the
existing GitHub release artifacts.

This works in that all artifacts on PyPI have a provenance attestation. There are a few downsides:

- The new provenance attestation is in a separate artifact on the GitHub Release rather than in the existing provenance attestation.
  This means that users looking to verify the provenance of the new wheels would likely need some manual discovery and steps to download
  the right provenance attestation file.

- Typically new architectures or platforms require a new version of `cibuildwheel`. Since there will need to be updates
  to the source code in order to bump the `cibuildwheel` version in use the git tag for the past release will not
  match the exact git commit needed to build the new wheels. This means that the provenance attestation won't include information
  about the git tag so verifying with the `--source-tag` option won't work as expected.

Another potential solution to the first point above is to create a completely new provenance attestation containing hashes
of both old and new artifacts. I'll be experimenting with this more and if successful providing guidance, stay tuned!

## Projects in use

<p>These are all the GitHub Actions and tools that this article uses:</p>
<ul>
<li><a href="https://github.com/slsa-framework/slsa-github-generator/blob/main/internal/builders/generic/README.md">SLSA GitHub Builder</a></li>
<li><a href="https://github.com/slsa-framework/slsa-verifier">slsa-framework/slsa-verifier</a></li>
<li><a href="https://github.com/pypa/gh-action-pypi-publish">pypa/gha-action-pypi-publish</a></li>
<li><a href="https://github.com/pypa/build">pypa/build</a></li>
<li><a href="https://github.com/pypa/cibuildwheel">pypa/cibuildwheel</a></li>
</ul>

<p>The following projects are used as examples of how to configure Python releases with SLSA in GitHub Actions:</p>
<ul>
<li><a href="https://github.com/urllib3/urllib3/blob/main/.github/workflows/publish.yml">urllib3/urllib3</a></li>
<li><a href="https://github.com/pallets/markupsafe/blob/main/.github/workflows/publish.yaml">pallets/markupsafe</a></li>
</ul>

### Diagrams

All the SVG diagrams above are [available on GitHub](https://github.com/sethmlarson/diagrams/tree/main/diagrams/python-and-slsa) and were made with [drawio](https://app.diagrams.net).
